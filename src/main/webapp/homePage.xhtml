<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
>


<f:view>
    <h:head>
        <title>#{i18n['homepage']}</title>
        <h:outputStylesheet library="css" name="styleHomePage.css"/>
    </h:head>
    <h:body>
        <p:growl id="growl" sticky="false" showDetail="true" life="8000"/>

        <h:form>
            <div class="w3-teal">
                <p:commandButton icon="bugIcon.png" oncomplete="PF('sidebar1').show()" style="background: none"/>
                <span>JBugger

            <span>

                <h:commandLink id="btnRomania" action="#{language.changeLanguage('ro')}" styleClass="romaniaIconStyle"/>

                  <h:commandLink id="btnUK" action="#{language.changeLanguage('')}" styleClass="UKIconStyle"/>

            </span>

                <i class='icon'/> <span
                            class="icon1"> #{i18n['welcomeMessage']}, #{loginBean.currentlyLoggedInUsername} !</span>

            </span>
            </div>
        </h:form>

        <div class="content" style=" background-color:lavenderblush; height: 100vh;">
            <h:form id="form1" style="width:auto;position: absolute">
                <p:dataTable id="bugsTable" var="bug" value="#{dataTableBean.bugList}" widgetVar="bugTable"
                              rowKey="#{bug.title}" ajax="true"
                             emptyMessage="No bugs found with given criteria" style="width: auto" >

                    <f:facet name="header">
                        <p:outputPanel style="text-align: center;">
                            <h:outputText value="Search all fields:" />
                            <p:inputText id="globalFilter" onkeyup="PF('bugTable').filter()" style="width:150px" placeholder="Enter keyword" />

                            <div style="float:right;padding-top: 5px;">
                                <h:commandLink>
                                    <p:graphicImage styleClass="excelButton" width="24"/>
                                    <p:dataExporter type="xls" target="bugsTable" fileName="bugs"/>
                                </h:commandLink>

                                <h:commandLink>
                                    <p:graphicImage styleClass="pdfButton" width="24"/>
                                    <p:dataExporter type="pdf" target="bugsTable" fileName="bugsPDF"/>
                                </h:commandLink>
                            </div>

                        </p:outputPanel>


                    </f:facet>

                    <p:column selectionMode="multiple" style="width:16px;text-align:center"/>

                    <p:column sortBy="#{bug.title}" filterBy="#{bug.title}" headerText="Title"  filterMatchMode="contains" >
                        <h:outputText value="#{bug.title}" />
                    </p:column>

                    <p:column filterBy="#{bug.description}" headerText="Description"  filterMatchMode="contains" sortBy="#{bug.description}">
                        <h:outputText value="#{bug.description}" />
                    </p:column>

                    <p:column filterBy="#{bug.version}" headerText="Version"  filterMatchMode="exact" sortBy="#{bug.version}">
                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('bugTable').filter()" styleClass="custom-filter">
                            <f:selectItem itemLabel="Select One" itemValue="#{null}" noSelectionOption="true" />
                            <f:selectItems value="#{dataTableBean.versions}" />
                        </p:selectOneMenu>
                    </f:facet>
                    <h:outputText value="#{bug.version}" />
                </p:column>

                    <p:column filterBy="#{bug.targetDate.toLocalDate()}" headerText="Target date" filterMatchMode="contains" sortBy="#{bug.targetDate.toLocalDate()}">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('bugTable').filter()" styleClass="custom-filter">
                                <f:selectItem itemLabel="Select One" itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItems value="#{dataTableBean.targetDates}" />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{bug.targetDate.toLocalDate()}" />
                    </p:column>

                    <p:column filterBy="#{bug.createdId.username}" headerText="Created by"  filterMatchMode="exact" sortBy="#{bug.createdId.username}">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('bugTable').filter()" styleClass="custom-filter">
                                <f:selectItem itemLabel="Select One" itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItems value="#{dataTableBean.createdByList}" />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{bug.createdId.username}" />
                    </p:column>

                    <p:column filterBy="#{bug.assignedId.username}" headerText="Assigned to"  filterMatchMode="exact" sortBy="#{bug.assignedId.username}">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('bugTable').filter()" styleClass="custom-filter">
                                <f:selectItem itemLabel="Select One" itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItems value="#{dataTableBean.assignedToList}" />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{bug.assignedId.username}" />
                    </p:column>

                    <p:column filterBy="#{bug.severity}" headerText="Severity"  filterMatchMode="in" sortBy="#{bug.severity}">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="Severity" onchange="PF('bugTable').filter()" scrollHeight="150" styleClass="custom-filter">
                                <f:selectItems value="#{constantsBean.severities}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <h:outputText value="#{bug.severity}" />
                    </p:column>

                    <p:column filterBy="#{bug.status}" headerText="Status"  filterMatchMode="in" sortBy="#{bug.status}">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="Status" onchange="PF('bugTable').filter()" scrollHeight="150" styleClass="custom-filter">
                                <f:selectItems value="#{constantsBean.states}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <h:outputText value="#{bug.status}" />
                    </p:column>
                    <p:column  headerText="Download attachment" style="width: 8%;;text-align: center">
                        <p:commandButton update=":form1:dlgBug" onclick="PrimeFaces.monitorDownload(start, stop);" icon="fa fa-download" title="View">
                            <f:setPropertyActionListener value="#{bug}" target="#{dataTableBean.selectedBug}" />
                            <p:fileDownload value="#{dataTableBean.downloadAttachment()}"/>

                        </p:commandButton>
                    </p:column>
                    <p:column headerText="Edit" style="width: 8%;;text-align: center">
                        <p:commandButton update=":form1:dlgBug" oncomplete="PF('bugDialog').show()" icon="fa fa-edit" title="View">
                            <f:setPropertyActionListener value="#{bug}" target="#{dataTableBean.selectedBug}" />
                        </p:commandButton>
                    </p:column>


                </p:dataTable>

                <p:dialog header="Bug Info" widgetVar="bugDialog" modal="true" showEffect="fade" hideEffect="fade" resizable="false" id="dlgBug">
                    <p:outputPanel id="bugDetail" style="text-align:center;">
                        <p:panelGrid  columns="2" rendered="#{not empty dataTableBean.selectedBug}" >
                            <f:facet name="header">
                                <h3>Title</h3>
                                <p:inputText value="#{dataTableBean.selectedBug.title}"/>
                            </f:facet>

                            <h:outputText value="Description" />
                            <h:inputTextarea value="#{dataTableBean.selectedBug.description}" />

                            <h:outputText value="Version" />
                            <h:inputText value="#{dataTableBean.selectedBug.version}" />

                            <h:outputText value="Severity" />
                            <h:selectOneMenu id="sev"  style="width:150px" ajax="true">
                                <p:ajax update="sev"/>
                                <f:selectItem  itemValue="#{dataTableBean.selectedBug.severity}" />
                                <f:selectItems value="#{constantsBean.severities}" />
                            </h:selectOneMenu>

                            <h:outputText value="Status" />
                            <h:selectOneMenu id="status"  style="width:150px" ajax="true">
                                <f:selectItem  itemValue="#{dataTableBean.selectedBug.status}" />
                                <f:selectItems value="#{constantsBean.states}" />
                            </h:selectOneMenu>

                            <h:outputText value="Assigned  to" />
                            <h:selectOneMenu id="user" style="width:150px">
                                <f:selectItem  itemValue="#{dataTableBean.selectedBug.assignedId.username}" />
                                <f:selectItems value="#{userManagementBean.activeUserNamesList()}" />
                            </h:selectOneMenu>
                            <h:outputText value="Attachment" />
                            <h:panelGrid columns="2">
                                <p:commandButton value="Delete"/>
                                <p:commandButton value="Add" />
                            </h:panelGrid>

                        </p:panelGrid>
                        <br></br><br/>
                        <p:commandButton value="Save"></p:commandButton>
                    </p:outputPanel>
                </p:dialog>
            </h:form>
        </div>

        <p:sidebar widgetVar="sidebar1" baseZIndex="10000" style="background:darkcyan; width:15em">
            <div class="sideBar">
                <h2 style="color: white">JBugger</h2>
                <div class="buttons">
                    <div class="addData">

                        <p:commandButton icon="fa fa-plus" type="button" onclick="PF('dlg1').show();"/>
                        <p:dialog header="#{i18n['insertOptions']}" widgetVar="dlg1" minHeight="40" width="295"
                                  height="30"
                                  styleClass="customDialog">
                            <p:commandButton value="#{i18n['user']}" class="button" styleClass="button" rendered="#{loginBean.userManagement}"
                                             onclick="PF('dlg_addUser').show(); PF('dlg1').close();"/><p:spacer></p:spacer>
                            <p:dialog id="userInsertDialog" header="#{i18n['createUser']}" widgetVar="dlg_addUser"
                                      minHeight="40"
                                      width="310"
                                      height="500">
                                <p:ajax event="close" listener="#{userManagementBean.clearUserFields()}"
                                        update="userInsertDialog"/>
                                <h:form id="userForm">

                                    <h:outputText styleClass="myFont" value="#{i18n['firstName']}"
                                                  style="display:block;"/>
                                    <p:inputText value="#{userManagementBean.firstName}"/>
                                    <br/><br/>

                                    <h:outputText styleClass="myFont" value="#{i18n['lastName']}"
                                                  style="display:block;"/>
                                    <p:inputText value="#{userManagementBean.lastName}"/>
                                    <br/><br/>

                                    <h:outputText styleClass="myFont" value="Email" style="display:block;"/>
                                    <p:inputText value="#{userManagementBean.email}"/>
                                    <br/><br/>

                                    <h:outputText styleClass="myFont" value="#{i18n['phone']}" style="display:block;"/>
                                    <p:inputText value="#{userManagementBean.mobile}"/>
                                    <br/><br/>

                                    <h:outputText styleClass="myFont" value="#{i18n['password']}"
                                                  style="display:block;"/>
                                    <p:password value="#{userManagementBean.password}"/><br></br>

                                    <h:outputText styleClass="myFont" value="#{i18n['confirmPassword']}"
                                                  style="display:block;"/>
                                    <p:password value="#{userManagementBean.confirmPassword}"/><br></br>

                                    <br></br>
                                    <p:selectCheckboxMenu id="rolesUser" value="#{userManagementBean.userRoleList}"
                                                          label="#{i18n['roles']}"
                                                          filter="true" filterMatchMode="startsWith"
                                                          panelStyle="width:auto; margin-left: 0px; margin-right: 5px"
                                                          required="true"
                                                          appendTo="@this">
                                        <f:selectItems value="#{roleManagementBean.roleList}"/>
                                    </p:selectCheckboxMenu>
                                    <br></br><br></br>
                                    <p:commandButton value="#{i18n['createUser']}" class="button"
                                                     styleClass="button" ajax="true" update="growl"
                                                     action="#{userManagementBean.createUser}"/>
                                    <br/><br/>
                                </h:form>
                            </p:dialog>
                            <p:commandButton value="#{i18n['bug']}" class="button" styleClass="button" rendered="#{loginBean.bugManagement}"
                                             onclick="PF('dlg_addBug').show();PF('dlg1').close();"/>
                            <p:dialog id="bugInsertDialog" header="#{i18n['createBug']}" widgetVar="dlg_addBug"
                                      minHeight="40"
                                      width="370"
                                      height="500" onHide="#{bugManagementBean.clearBugFields()}">
                                <p:ajax update="bugInsertDialog"/>
                                <h:form id="bugForm" enctype="multipart/form-data">

                                    <h:outputText styleClass="myFont" value="#{i18n['title']}" style="display:block;"/>
                                    <p:inputText value="#{bugManagementBean.title}"/>
                                    <br/><br/>

                                    <h:outputText styleClass="myFont" value="#{i18n['version']}"
                                                  style="display:block;"/>
                                    <p:inputText value="#{bugManagementBean.version}"/>
                                    <br/><br/>


                                    <h:outputText styleClass="myFont" value="#{i18n['severity']}"
                                                  style="display:block;"/>
                                    <p:selectOneMenu id="severity" value="#{bugManagementBean.severity}" effect="fold"
                                                     required="true"
                                                     appendTo="@this">
                                        <f:selectItems value="#{constantsBean.severities}"/>
                                    </p:selectOneMenu><br></br><br></br>

                                    <h:outputText styleClass="myFont" value="#{i18n['assignedTo']}"
                                                  style="display:block;"/>
                                    <p:selectOneMenu id="assignedUser"
                                                     value="#{bugManagementBean.stringUserAssignedToFixIt}"
                                                     effect="fold" editable="true" required="true"
                                                     appendTo="@this">
                                        <f:selectItems value="#{userManagementBean.activeUserNamesList()}"/>
                                    </p:selectOneMenu><br></br><br></br>

                                    <h:outputText styleClass="myFont" value="#{i18n['targetDate']}"
                                                  style="display:block;"/>
                                    <h:outputScript name="javascripts/roCalendar.js"/>
                                    <p:calendar id="targetDateCalendar" value="#{bugManagementBean.selectedDate}"
                                                mode="inline" pattern="MM/dd/yy"
                                                mindate="#{bugManagementBean.present}"/>
                                    <br/><br/>

                                    <h:outputText styleClass="myFont" value="#{i18n['description']}"
                                                  style="display:block;"/>
                                    <p:inputTextarea value="#{bugManagementBean.description}"/>
                                    <br/><br/>
                                    <h:outputText styleClass="myFont" value="#{i18n['attachment']}"
                                                  style="display:block;"/>
                                    <p:fileUpload fileUploadListener="#{fileUploadView.handleFileUpload}"
                                                  allowTypes="/(\.|\/)(gif|jpe?g|png|pdf|doc|xls|xlsx|odf)$/"
                                                  sizeLimit="25000001" invalidSizeMessage="#{i18n['invalidFileSize']}"
                                                  fileLimit="1"
                                                  mode="advanced" skinSimple="true"/>

                                    <br></br><br></br>
                                    <p:commandButton value="#{i18n['saveBug']}" class="button" styleClass="button"
                                                     action="#{bugManagementBean.createBug}"
                                                     onclick="PF('dlg_addBug').close();"/>
                                    <br/><br/>
                                </h:form>
                            </p:dialog>
                        </p:dialog>

                    </div>
                    <div class="editData">
                        <p:commandButton icon="fa fa-edit" type="button" onclick="PF('dlg_edit').show();"/>
                        <p:dialog header="#{i18n['editOptions']}" widgetVar="dlg_edit" minHeight="40" width="295"
                                  height="30"
                                  styleClass="customDialog">

                            <p:commandButton value="#{i18n['role']}" class="button" styleClass="button" rendered="#{loginBean.permisionManagement}"
                                             onclick="PF('dlg_EditRole').show();PF('dlg_edit').close();"/>
                            <p:dialog header="#{i18n['editRole']}" widgetVar="dlg_EditRole" minHeight="40" width="370"
                                      height="auto">
                                <h:form id="editRoleForm">
                                    <p:selectOneMenu id="roles" value="#{roleManagementBean.selectedRole}" effect="fold"
                                                     editable="false" required="true"
                                                     appendTo="@this">
                                        <f:selectItems value="#{roleManagementBean.roleList}"/>
                                    </p:selectOneMenu><br></br><br></br>
                                    <br></br>
                                    <p:selectCheckboxMenu id="rights" value="#{roleManagementBean.selectedRights}"
                                                          label="#{i18n['rights']}"
                                                          filter="true" filterMatchMode="startsWith"
                                                          panelStyle="width:auto; margin-left: 0px; margin-right: 5px"
                                                          required="true"
                                                          appendTo="@this">
                                        <f:selectItems value="#{roleManagementBean.rightsList}"/>
                                    </p:selectCheckboxMenu>

                                    <br></br><br></br><br></br><br></br>
                                    <p:commandButton value="#{i18n['updateRole']}" class="button" styleClass="button"
                                                     action="#{roleManagementBean.updateRoles}"
                                                     onclick="PF('dlg_EditRole').close();" style="margin-top:50%"/>
                                    <br/><br/>
                                </h:form>
                            </p:dialog>

                            <p:commandButton value="#{i18n['user']}" class="button" styleClass="button" rendered="#{loginBean.userManagement}"
                                             onclick="PF('dlg_EditUser').show();PF('dlg_edit').close();"/>
                            <p:dialog header="#{i18n['updateUser']}" widgetVar="dlg_EditUser" minHeight="40" width="370"
                                      height="auto">
                                <h:form id="editUserForm">

                                    <h:outputText styleClass="myFont" value="#{i18n['usernameSelection']}"
                                                  style="display:block;"/>
                                    <p:selectOneMenu id="users" value="#{userManagementBean.username}" effect="fold"
                                                     editable="true" required="true"
                                                     appendTo="@this" action="">
                                        <f:selectItems value="#{userManagementBean.userNamesList()}"/>
                                        <p:ajax event="change"
                                                update="firstName,lastName,email,mobile,pass,confirm,rolesSelect,activeStatus"
                                                process="@this"
                                                listener="${userManagementBean.prepareForUserUpdate()}"/>
                                    </p:selectOneMenu><br></br><br></br>

                                    <h:outputText value="#{i18n['active']}" styleClass="myFont" style="display:block;"
                                                  escape="true"/>
                                    <p:selectBooleanButton id="activeStatus"
                                                           disabled="#{userManagementBean.username==null}"
                                                           placeholder="#{userManagementBean.active}"
                                                           value="#{userManagementBean.active}" onLabel="Yes"
                                                           offLabel="No" style="width:60px"/>
                                    <h:outputText styleClass="myFont" value="#{i18n['firstName']}"
                                                  style="display:block;"
                                                  escape="true"/>
                                    <p:inputText value="#{userManagementBean.firstName}"
                                                 placeholder="#{userManagementBean.firstName}"
                                                 autocomplete="off" id="firstName"
                                                 disabled="#{userManagementBean.username==null}"/>

                                    <h:outputText styleClass="myFont" value="#{i18n['lastName']}" style="display:block;"
                                                  escape="true"/>
                                    <p:inputText id="lastName" value="#{userManagementBean.lastName}"
                                                 disabled="#{userManagementBean.username==null}"/>
                                    <br/><br/>

                                    <h:outputText styleClass="myFont" value="Email" style="display:block;"
                                                  escape="true"/>
                                    <p:inputText id="email" placeholder="#{userManagementBean.email}"
                                                 value="#{userManagementBean.email}"
                                                 disabled="#{userManagementBean.username==null}"/>
                                    <br/><br/>

                                    <h:outputText styleClass="myFont" value="#{i18n['phone']}" style="display:block;"
                                                  escape="true"/>
                                    <p:inputText id="mobile" placeholder="#{userManagementBean.mobile}"
                                                 value="#{userManagementBean.mobile}"
                                                 disabled="#{userManagementBean.username==null}"/>
                                    <br/><br/>

                                    <h:outputText styleClass="myFont" value="#{i18n['password']}" style="display:block;"
                                                  escape="true"/>
                                    <p:password id="pass" value="#{userManagementBean.password}"
                                                disabled="#{userManagementBean.username==null}"/><br></br>

                                    <h:outputText styleClass="myFont" value="#{i18n['confirmPassword']}"
                                                  style="display:block;"
                                                  escape="true"/>
                                    <p:password id="confirm" value="#{userManagementBean.confirmPassword}"
                                                disabled="#{userManagementBean.username==null}"/><br></br>

                                    <br></br>


                                    <p:selectCheckboxMenu id="rolesSelect" value="#{userManagementBean.userRoleList}"
                                                          label="#{i18n['roles']}"
                                                          filter="true" filterMatchMode="startsWith"
                                                          panelStyle="width:auto; margin-left: 0px; margin-right: 5px"
                                                          appendTo="@this">
                                        <f:selectItems value="#{roleManagementBean.roleList}"/>
                                    </p:selectCheckboxMenu>
                                    <br></br><br></br>

                                    <p:commandButton value="#{i18n['updateUser']}" class="button" ajax="true"
                                                     styleClass="button" update="growl"
                                                     action="#{userManagementBean.userUpdate}"
                                    />
                                    <br/><br/>
                                </h:form>
                            </p:dialog>
                        </p:dialog>
                    </div>
                    <div class="statistics">
                        <p:commandButton icon="fa fa-pie-chart"/>
                    </div>
                    <br></br>
                    <br></br>
                    <div class="log-out">
                        <h:form><p:commandButton ajax="false" action="#{navigationBean.navigateTo('login')}"
                                                 icon="fa fa-sign-out"/></h:form>
                    </div>
                </div>
            </div>
        </p:sidebar>
        <script type="text/javascript">
            if (window.history.replaceState) {
                window.history.replaceState(null, null, window.location.href);
            }
        </script>
    </h:body>
</f:view>
</html>
